{
  "version": 3,
  "sources": ["../../hono/dist/utils/cookie.js", "../../hono/dist/helper/cookie/index.js"],
  "sourcesContent": ["// src/utils/cookie.ts\r\nimport { decodeURIComponent_ } from \"./url.js\";\r\nvar algorithm = { name: \"HMAC\", hash: \"SHA-256\" };\r\nvar getCryptoKey = async (secret) => {\r\n  const secretBuf = typeof secret === \"string\" ? new TextEncoder().encode(secret) : secret;\r\n  return await crypto.subtle.importKey(\"raw\", secretBuf, algorithm, false, [\"sign\", \"verify\"]);\r\n};\r\nvar makeSignature = async (value, secret) => {\r\n  const key = await getCryptoKey(secret);\r\n  const signature = await crypto.subtle.sign(algorithm.name, key, new TextEncoder().encode(value));\r\n  return btoa(String.fromCharCode(...new Uint8Array(signature)));\r\n};\r\nvar verifySignature = async (base64Signature, value, secret) => {\r\n  try {\r\n    const signatureBinStr = atob(base64Signature);\r\n    const signature = new Uint8Array(signatureBinStr.length);\r\n    for (let i = 0, len = signatureBinStr.length; i < len; i++) {\r\n      signature[i] = signatureBinStr.charCodeAt(i);\r\n    }\r\n    return await crypto.subtle.verify(algorithm, secret, signature, new TextEncoder().encode(value));\r\n  } catch {\r\n    return false;\r\n  }\r\n};\r\nvar validCookieNameRegEx = /^[\\w!#$%&'*.^`|~+-]+$/;\r\nvar validCookieValueRegEx = /^[ !#-:<-[\\]-~]*$/;\r\nvar parse = (cookie, name) => {\r\n  if (name && cookie.indexOf(name) === -1) {\r\n    return {};\r\n  }\r\n  const pairs = cookie.trim().split(\";\");\r\n  const parsedCookie = {};\r\n  for (let pairStr of pairs) {\r\n    pairStr = pairStr.trim();\r\n    const valueStartPos = pairStr.indexOf(\"=\");\r\n    if (valueStartPos === -1) {\r\n      continue;\r\n    }\r\n    const cookieName = pairStr.substring(0, valueStartPos).trim();\r\n    if (name && name !== cookieName || !validCookieNameRegEx.test(cookieName)) {\r\n      continue;\r\n    }\r\n    let cookieValue = pairStr.substring(valueStartPos + 1).trim();\r\n    if (cookieValue.startsWith('\"') && cookieValue.endsWith('\"')) {\r\n      cookieValue = cookieValue.slice(1, -1);\r\n    }\r\n    if (validCookieValueRegEx.test(cookieValue)) {\r\n      parsedCookie[cookieName] = decodeURIComponent_(cookieValue);\r\n      if (name) {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  return parsedCookie;\r\n};\r\nvar parseSigned = async (cookie, secret, name) => {\r\n  const parsedCookie = {};\r\n  const secretKey = await getCryptoKey(secret);\r\n  for (const [key, value] of Object.entries(parse(cookie, name))) {\r\n    const signatureStartPos = value.lastIndexOf(\".\");\r\n    if (signatureStartPos < 1) {\r\n      continue;\r\n    }\r\n    const signedValue = value.substring(0, signatureStartPos);\r\n    const signature = value.substring(signatureStartPos + 1);\r\n    if (signature.length !== 44 || !signature.endsWith(\"=\")) {\r\n      continue;\r\n    }\r\n    const isVerified = await verifySignature(signature, signedValue, secretKey);\r\n    parsedCookie[key] = isVerified ? signedValue : false;\r\n  }\r\n  return parsedCookie;\r\n};\r\nvar _serialize = (name, value, opt = {}) => {\r\n  let cookie = `${name}=${value}`;\r\n  if (name.startsWith(\"__Secure-\") && !opt.secure) {\r\n    throw new Error(\"__Secure- Cookie must have Secure attributes\");\r\n  }\r\n  if (name.startsWith(\"__Host-\")) {\r\n    if (!opt.secure) {\r\n      throw new Error(\"__Host- Cookie must have Secure attributes\");\r\n    }\r\n    if (opt.path !== \"/\") {\r\n      throw new Error('__Host- Cookie must have Path attributes with \"/\"');\r\n    }\r\n    if (opt.domain) {\r\n      throw new Error(\"__Host- Cookie must not have Domain attributes\");\r\n    }\r\n  }\r\n  if (opt && typeof opt.maxAge === \"number\" && opt.maxAge >= 0) {\r\n    if (opt.maxAge > 3456e4) {\r\n      throw new Error(\r\n        \"Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.\"\r\n      );\r\n    }\r\n    cookie += `; Max-Age=${opt.maxAge | 0}`;\r\n  }\r\n  if (opt.domain && opt.prefix !== \"host\") {\r\n    cookie += `; Domain=${opt.domain}`;\r\n  }\r\n  if (opt.path) {\r\n    cookie += `; Path=${opt.path}`;\r\n  }\r\n  if (opt.expires) {\r\n    if (opt.expires.getTime() - Date.now() > 3456e7) {\r\n      throw new Error(\r\n        \"Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.\"\r\n      );\r\n    }\r\n    cookie += `; Expires=${opt.expires.toUTCString()}`;\r\n  }\r\n  if (opt.httpOnly) {\r\n    cookie += \"; HttpOnly\";\r\n  }\r\n  if (opt.secure) {\r\n    cookie += \"; Secure\";\r\n  }\r\n  if (opt.sameSite) {\r\n    cookie += `; SameSite=${opt.sameSite.charAt(0).toUpperCase() + opt.sameSite.slice(1)}`;\r\n  }\r\n  if (opt.priority) {\r\n    cookie += `; Priority=${opt.priority}`;\r\n  }\r\n  if (opt.partitioned) {\r\n    if (!opt.secure) {\r\n      throw new Error(\"Partitioned Cookie must have Secure attributes\");\r\n    }\r\n    cookie += \"; Partitioned\";\r\n  }\r\n  return cookie;\r\n};\r\nvar serialize = (name, value, opt) => {\r\n  value = encodeURIComponent(value);\r\n  return _serialize(name, value, opt);\r\n};\r\nvar serializeSigned = async (name, value, secret, opt = {}) => {\r\n  const signature = await makeSignature(value, secret);\r\n  value = `${value}.${signature}`;\r\n  value = encodeURIComponent(value);\r\n  return _serialize(name, value, opt);\r\n};\r\nexport {\r\n  parse,\r\n  parseSigned,\r\n  serialize,\r\n  serializeSigned\r\n};\r\n", "// src/helper/cookie/index.ts\r\nimport { parse, parseSigned, serialize, serializeSigned } from \"../../utils/cookie.js\";\r\nvar getCookie = (c, key, prefix) => {\r\n  const cookie = c.req.raw.headers.get(\"Cookie\");\r\n  if (typeof key === \"string\") {\r\n    if (!cookie) {\r\n      return void 0;\r\n    }\r\n    let finalKey = key;\r\n    if (prefix === \"secure\") {\r\n      finalKey = \"__Secure-\" + key;\r\n    } else if (prefix === \"host\") {\r\n      finalKey = \"__Host-\" + key;\r\n    }\r\n    const obj2 = parse(cookie, finalKey);\r\n    return obj2[finalKey];\r\n  }\r\n  if (!cookie) {\r\n    return {};\r\n  }\r\n  const obj = parse(cookie);\r\n  return obj;\r\n};\r\nvar getSignedCookie = async (c, secret, key, prefix) => {\r\n  const cookie = c.req.raw.headers.get(\"Cookie\");\r\n  if (typeof key === \"string\") {\r\n    if (!cookie) {\r\n      return void 0;\r\n    }\r\n    let finalKey = key;\r\n    if (prefix === \"secure\") {\r\n      finalKey = \"__Secure-\" + key;\r\n    } else if (prefix === \"host\") {\r\n      finalKey = \"__Host-\" + key;\r\n    }\r\n    const obj2 = await parseSigned(cookie, secret, finalKey);\r\n    return obj2[finalKey];\r\n  }\r\n  if (!cookie) {\r\n    return {};\r\n  }\r\n  const obj = await parseSigned(cookie, secret);\r\n  return obj;\r\n};\r\nvar setCookie = (c, name, value, opt) => {\r\n  let cookie;\r\n  if (opt?.prefix === \"secure\") {\r\n    cookie = serialize(\"__Secure-\" + name, value, { path: \"/\", ...opt, secure: true });\r\n  } else if (opt?.prefix === \"host\") {\r\n    cookie = serialize(\"__Host-\" + name, value, {\r\n      ...opt,\r\n      path: \"/\",\r\n      secure: true,\r\n      domain: void 0\r\n    });\r\n  } else {\r\n    cookie = serialize(name, value, { path: \"/\", ...opt });\r\n  }\r\n  c.header(\"Set-Cookie\", cookie, { append: true });\r\n};\r\nvar setSignedCookie = async (c, name, value, secret, opt) => {\r\n  let cookie;\r\n  if (opt?.prefix === \"secure\") {\r\n    cookie = await serializeSigned(\"__Secure-\" + name, value, secret, {\r\n      path: \"/\",\r\n      ...opt,\r\n      secure: true\r\n    });\r\n  } else if (opt?.prefix === \"host\") {\r\n    cookie = await serializeSigned(\"__Host-\" + name, value, secret, {\r\n      ...opt,\r\n      path: \"/\",\r\n      secure: true,\r\n      domain: void 0\r\n    });\r\n  } else {\r\n    cookie = await serializeSigned(name, value, secret, { path: \"/\", ...opt });\r\n  }\r\n  c.header(\"set-cookie\", cookie, { append: true });\r\n};\r\nvar deleteCookie = (c, name, opt) => {\r\n  const deletedCookie = getCookie(c, name);\r\n  setCookie(c, name, \"\", { ...opt, maxAge: 0 });\r\n  return deletedCookie;\r\n};\r\nexport {\r\n  deleteCookie,\r\n  getCookie,\r\n  getSignedCookie,\r\n  setCookie,\r\n  setSignedCookie\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
